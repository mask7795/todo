<!-- Snackbar Toast -->
<div *ngIf="showSnackbar" style="position:fixed;left:50%;bottom:36px;transform:translateX(-50%);background:#323232;color:#fff;padding:14px 32px;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.18);font-size:1.1rem;z-index:1000;transition:opacity 0.3s;opacity:0.97;">
  {{ snackbarMessage }}
</div>

<div class="toolbar">

  <!-- Quick Add Todo Inline Form -->
  <form (ngSubmit)="quickAdd()" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
    <input
      type="text"
      placeholder="Quick add todo..."
      [(ngModel)]="quickAddTitle"
      name="quickAddTitle"
      [disabled]="quickAddLoading"
      style="padding: 6px 10px; border-radius: 4px; border: 1px solid #ccc; min-width: 180px;"
      required
    />
    <button type="submit" [disabled]="quickAddLoading || !quickAddTitle.trim()" style="padding: 6px 14px; border-radius: 4px; background: #388e3c; color: #fff; font-weight: 500;">Add</button>
    <span *ngIf="quickAddLoading" style="margin-left: 8px; color: #888;">Adding…</span>
    <span *ngIf="quickAddError" style="margin-left: 8px; color: #b00020;">{{ quickAddError }}</span>
  </form>
  <label>
    Completed:
    <select [(ngModel)]="showCompleted" (change)="fetch()">
      <option [ngValue]="undefined">All</option>
      <option [ngValue]="true">Only Completed</option>
      <option [ngValue]="false">Only Active</option>
    </select>
  </label>
  <label>
    Priority:
    <select [(ngModel)]="priority" (change)="fetch()">
      <option [ngValue]="undefined">All</option>
      <option value="low">Low</option>
      <option value="medium">Medium</option>
      <option value="high">High</option>
    </select>
  </label>
  <label>
    Overdue:
    <select [(ngModel)]="overdue" (change)="fetch()">
      <option [ngValue]="undefined">All</option>
      <option [ngValue]="true">Overdue</option>
      <option [ngValue]="false">Not Overdue</option>
    </select>
  </label>
  <label>
    Include Deleted:
    <select [(ngModel)]="includeDeleted" (change)="fetch()">
      <option [ngValue]="undefined">No</option>
      <option [ngValue]="true">Yes</option>
    </select>
  </label>
  <label>
    Sort by Due:
    <select [(ngModel)]="sortDue" (change)="fetch()">
      <option [ngValue]="undefined">Default</option>
      <option [ngValue]="true">Yes</option>
    </select>
  </label>
</div>

<div *ngIf="error" class="error">{{ error }}</div>
<div *ngIf="loading" style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;">
  <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom:1rem;">
    <circle cx="20" cy="20" r="18" stroke="#e1e4e8" stroke-width="4"/>
    <path d="M38 20c0-9.94-8.06-18-18-18" stroke="#1976d2" stroke-width="4" stroke-linecap="round">
      <animateTransform attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="0.8s" repeatCount="indefinite"/>
    </path>
  </svg>
  <p>Loading todos…</p>
</div>

<ul class="todos" data-testid="todos-list">
  <li *ngFor="let t of todos" data-testid="todo-item">
    <span data-testid="todo-title" [class.completed]="t.completed" [class.deleted]="t.deleted_at" [class.overdue]="isOverdue(t)">{{ t.title }}</span>
    <span class="meta">
      <span *ngIf="t.priority">[{{ t.priority }}]</span>
      <span *ngIf="t.due_at">due {{ t.due_at | date: 'short' }}</span>
      <span *ngIf="t.deleted_at" class="badge">deleted</span>
    </span>
    <div style="margin-top:0.5rem;">
      <button data-testid="toggle-complete" (click)="toggleComplete(t)">{{ t.completed ? 'Mark Active' : 'Mark Done' }}</button>
      <button data-testid="delete" (click)="delete(t)">Delete</button>
      <button data-testid="restore" (click)="restore(t)" [disabled]="!t.deleted_at">Restore</button>
    </div>
  </li>
</ul>

<div class="pager">
  <button (click)="prevPage()" [disabled]="offset <= 0">Prev</button>
  <button (click)="nextPage()" [disabled]="!hasMore">Next</button>
</div>
